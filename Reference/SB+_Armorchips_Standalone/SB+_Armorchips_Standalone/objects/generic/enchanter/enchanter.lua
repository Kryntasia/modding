local recipes =
{
--  inputs = {{item = "lolitem",amount = 3}, {item = "lolitem2", amount = 4}}   go like that if you want multiples

-- Tier 1 Head
{inputs = {"t1_head", "ability_invisibility" }, outputs = { "t1_head_invisibility"}, time = 1},
{inputs = {"t1_head", "ability_maxenergy" }, outputs = { "t1_head_maxenergy"}, time = 1},
{inputs = {"t1_head", "ability_maxhealth" }, outputs = { "t1_head_maxhealth"}, time = 1},
-- Tier 1 Chest
{inputs = {"t1_chest", "ability_energyregeneration" }, outputs = { "t1_chest_energyregen"}, time = 1},
{inputs = {"t1_chest", "ability_regeneration" }, outputs = { "t1_chest_regeneration"}, time = 1},
{inputs = {"t1_chest", "ability_rage" }, outputs = { "t1_chest_rage"}, time = 1},
-- Tier 1 Pants
{inputs = {"t1_pants", "ability_jumpboost" }, outputs = { "t1_pants_jumpboost"}, time = 1},
{inputs = {"t1_pants", "ability_lowgrav" }, outputs = { "t1_pants_lowgrav"}, time = 1},
{inputs = {"t1_pants", "ability_runboost" }, outputs = { "t1_pants_runboost"}, time = 1},
-- Tier 2 Head
{inputs = {"t2_head", "ability_invisibility" }, outputs = { "t2_head_invisibility"}, time = 1},
{inputs = {"t2_head", "ability_maxenergy" }, outputs = { "t2_head_maxenergy"}, time = 1},
{inputs = {"t2_head", "ability_maxhealth" }, outputs = { "t2_head_maxhealth"}, time = 1},
-- Tier 2 Chest
{inputs = {"t2_chest", "ability_energyregeneration" }, outputs = { "t2_chest_energyregen"}, time = 1},
{inputs = {"t2_chest", "ability_regeneration" }, outputs = { "t2_chest_regeneration"}, time = 1},
{inputs = {"t2_chest", "ability_rage" }, outputs = { "t2_chest_rage"}, time = 1},
-- Tier 2 Pants
{inputs = {"t2_pants", "ability_jumpboost" }, outputs = { "t2_pants_jumpboost"}, time = 1},
{inputs = {"t2_pants", "ability_lowgrav" }, outputs = { "t2_pants_lowgrav"}, time = 1},
{inputs = {"t2_pants", "ability_runboost" }, outputs = { "t2_pants_runboost"}, time = 1},
-- Tier 3 Head
{inputs = {"t3_head", "ability_invisibility" }, outputs = { "t3_head_invisibility"}, time = 1},
{inputs = {"t3_head", "ability_maxenergy" }, outputs = { "t3_head_maxenergy"}, time = 1},
{inputs = {"t3_head", "ability_maxhealth" }, outputs = { "t3_head_maxhealth"}, time = 1},
-- Tier 3 Chest
{inputs = {"t3_chest", "ability_energyregeneration" }, outputs = { "t3_chest_energyregen"}, time = 1},
{inputs = {"t3_chest", "ability_regeneration" }, outputs = { "t3_chest_regeneration"}, time = 1},
{inputs = {"t3_chest", "ability_rage" }, outputs = { "t3_chest_rage"}, time = 1},
-- Tier 3 Pants
{inputs = {"t3_pants", "ability_jumpboost" }, outputs = { "t3_pants_jumpboost"}, time = 1},
{inputs = {"t3_pants", "ability_lowgrav" }, outputs = { "t3_pants_lowgrav"}, time = 1},
{inputs = {"t3_pants", "ability_runboost" }, outputs = { "t3_pants_runboost"}, time = 1},
-- Tier 4 Head
{inputs = {"t4_head", "ability_invisibility" }, outputs = { "t4_head_invisibility"}, time = 1},
{inputs = {"t4_head", "ability_maxenergy" }, outputs = { "t4_head_maxenergy"}, time = 1},
{inputs = {"t4_head", "ability_maxhealth" }, outputs = { "t4_head_maxhealth"}, time = 1},
-- Tier 4 Chest
{inputs = {"t4_chest", "ability_energyregeneration" }, outputs = { "t4_chest_energyregen"}, time = 1},
{inputs = {"t4_chest", "ability_regeneration" }, outputs = { "t4_chest_regeneration"}, time = 1},
{inputs = {"t4_chest", "ability_rage" }, outputs = { "t4_chest_rage"}, time = 1},
-- Tier 4 Pants
{inputs = {"t4_pants", "ability_jumpboost" }, outputs = { "t4_pants_jumpboost"}, time = 1},
{inputs = {"t4_pants", "ability_lowgrav" }, outputs = { "t4_pants_lowgrav"}, time = 1},
{inputs = {"t4_pants", "ability_runboost" }, outputs = { "t4_pants_runboost"}, time = 1},
-- Tier 5 Head
{inputs = {"t5_head", "ability_invisibility" }, outputs = { "t5_head_invisibility"}, time = 1},
{inputs = {"t5_head", "ability_maxenergy" }, outputs = { "t5_head_maxenergy"}, time = 1},
{inputs = {"t5_head", "ability_maxhealth" }, outputs = { "t5_head_maxhealth"}, time = 1},
-- Tier 5 Chest
{inputs = {"t5_chest", "ability_energyregeneration" }, outputs = { "t5_chest_energyregen"}, time = 1},
{inputs = {"t5_chest", "ability_regeneration" }, outputs = { "t5_chest_regeneration"}, time = 1},
{inputs = {"t5_chest", "ability_rage" }, outputs = { "t5_chest_rage"}, time = 1},
-- Tier 5 Pants
{inputs = {"t5_pants", "ability_jumpboost" }, outputs = { "t5_pants_jumpboost"}, time = 1},
{inputs = {"t5_pants", "ability_lowgrav" }, outputs = { "t5_pants_lowgrav"}, time = 1},
{inputs = {"t5_pants", "ability_runboost" }, outputs = { "t5_pants_runboost"}, time = 1},
-- Tier 6 Head
{inputs = {"t6_head", "ability_invisibility" }, outputs = { "t6_head_invisibility"}, time = 1},
{inputs = {"t6_head", "ability_maxenergy" }, outputs = { "t6_head_maxenergy"}, time = 1},
{inputs = {"t6_head", "ability_maxhealth" }, outputs = { "t6_head_maxhealth"}, time = 1},
-- Tier 6 Chest
{inputs = {"t6_chest", "ability_energyregeneration" }, outputs = { "t6_chest_energyregen"}, time = 1},
{inputs = {"t6_chest", "ability_regeneration" }, outputs = { "t6_chest_regeneration"}, time = 1},
{inputs = {"t6_chest", "ability_rage" }, outputs = { "t6_chest_rage"}, time = 1},
-- Tier 6 Pants
{inputs = {"t6_pants", "ability_jumpboost" }, outputs = { "t6_pants_jumpboost"}, time = 1},
{inputs = {"t6_pants", "ability_lowgrav" }, outputs = { "t6_pants_lowgrav"}, time = 1},
{inputs = {"t6_pants", "ability_runboost" }, outputs = { "t6_pants_runboost"}, time = 1},
-- Tier 7 Head
{inputs = {"t7_head", "ability_invisibility" }, outputs = { "t7_head_invisibility"}, time = 1},
{inputs = {"t7_head", "ability_maxenergy" }, outputs = { "t7_head_maxenergy"}, time = 1},
{inputs = {"t7_head", "ability_maxhealth" }, outputs = { "t7_head_maxhealth"}, time = 1},
-- Tier 7 Chest
{inputs = {"t7_chest", "ability_energyregeneration" }, outputs = { "t7_chest_energyregen"}, time = 1},
{inputs = {"t7_chest", "ability_regeneration" }, outputs = { "t7_chest_regeneration"}, time = 1},
{inputs = {"t7_chest", "ability_rage" }, outputs = { "t7_chest_rage"}, time = 1},
-- Tier 7 Pants
{inputs = {"t7_pants", "ability_jumpboost" }, outputs = { "t7_pants_jumpboost"}, time = 1},
{inputs = {"t7_pants", "ability_lowgrav" }, outputs = { "t7_pants_lowgrav"}, time = 1},
{inputs = {"t7_pants", "ability_runboost" }, outputs = { "t7_pants_runboost"}, time = 1},
-- Tier 8 Head
{inputs = {"t8_head", "ability_invisibility" }, outputs = { "t8_head_invisibility"}, time = 1},
{inputs = {"t8_head", "ability_maxenergy" }, outputs = { "t8_head_maxenergy"}, time = 1},
{inputs = {"t8_head", "ability_maxhealth" }, outputs = { "t8_head_maxhealth"}, time = 1},
-- Tier 8 Chest
{inputs = {"t8_chest", "ability_energyregeneration" }, outputs = { "t8_chest_energyregen"}, time = 1},
{inputs = {"t8_chest", "ability_regeneration" }, outputs = { "t8_chest_regeneration"}, time = 1},
{inputs = {"t8_chest", "ability_rage" }, outputs = { "t8_chest_rage"}, time = 1},
-- Tier 8 Pants
{inputs = {"t8_pants", "ability_jumpboost" }, outputs = { "t8_pants_jumpboost"}, time = 1},
{inputs = {"t8_pants", "ability_lowgrav" }, outputs = { "t8_pants_lowgrav"}, time = 1},
{inputs = {"t8_pants", "ability_runboost" }, outputs = { "t8_pants_runboost"}, time = 1},
-- Tier 9 Head
{inputs = {"t9_head", "ability_invisibility" }, outputs = { "t9_head_invisibility"}, time = 1},
{inputs = {"t9_head", "ability_maxenergy" }, outputs = { "t9_head_maxenergy"}, time = 1},
{inputs = {"t9_head", "ability_maxhealth" }, outputs = { "t9_head_maxhealth"}, time = 1},
-- Tier 9 Chest
{inputs = {"t9_chest", "ability_energyregeneration" }, outputs = { "t9_chest_energyregen"}, time = 1},
{inputs = {"t9_chest", "ability_regeneration" }, outputs = { "t9_chest_regeneration"}, time = 1},
{inputs = {"t9_chest", "ability_rage" }, outputs = { "t9_chest_rage"}, time = 1},
-- Tier 9 Pants
{inputs = {"t9_pants", "ability_jumpboost" }, outputs = { "t9_pants_jumpboost"}, time = 1},
{inputs = {"t9_pants", "ability_lowgrav" }, outputs = { "t9_pants_lowgrav"}, time = 1},
{inputs = {"t9_pants", "ability_runboost" }, outputs = { "t9_pants_runboost"}, time = 1},
-- Tier 10 Head
{inputs = {"t10_head", "ability_invisibility" }, outputs = { "t10_head_invisibility"}, time = 1},
{inputs = {"t10_head", "ability_maxenergy" }, outputs = { "t10_head_maxenergy"}, time = 1},
{inputs = {"t10_head", "ability_maxhealth" }, outputs = { "t10_head_maxhealth"}, time = 1},
-- Tier 10 Chest
{inputs = {"t10_chest", "ability_energyregeneration" }, outputs = { "t10_chest_energyregen"}, time = 1},
{inputs = {"t10_chest", "ability_regeneration" }, outputs = { "t10_chest_regeneration"}, time = 1},
{inputs = {"t10_chest", "ability_rage" }, outputs = { "t10_chest_rage"}, time = 1},
-- Tier 10 Pants
{inputs = {"t10_pants", "ability_jumpboost" }, outputs = { "t10_pants_jumpboost"}, time = 1},
{inputs = {"t10_pants", "ability_lowgrav" }, outputs = { "t10_pants_lowgrav"}, time = 1},
{inputs = {"t10_pants", "ability_runboost" }, outputs = { "t10_pants_runboost"}, time = 1}

}

function init(args)
    self.timer = 0
    self.recipe = nil
    self.crafting = false
end

function hasValidRecipe()
    local id = entity.id()
    local contents = world.containerItems(entity.id())

    for _, recipe in pairs(recipes) do
        local hasRecipe = true
        for id, item in pairs(recipe.inputs) do
            local found = false
            for i, inv in pairs(contents) do
                if item == inv.name then
                    found = true
                    break -- Break the item search loop
                end
            end
           
            if not found then
                hasRecipe = false
                break -- Break loop for current recipe
            end
        end
       
        -- Do we have the match?
        if hasRecipe then
            return true, recipe
        end
    end
   
    return false, nil
end

-- Adds in/Removes the items. If you added the amount param to tables, be sure to update it here.
function generateRecipe()
    local recipe = self.recipe
    local entID = entity.id()
   
    -- Add the output items
    for k, item in pairs(recipe.outputs) do
        local itemsRemaining = world.containerAddItems(entID, { name= item, count = 1, data={}})

        if itemsRemaining then
            world.spawnItem(itemsRemaining.item, entity.position(), itemsRemaining.amount)
        end
    end
	
	   -- Remove the input items
    for k, v in pairs(recipe.inputs) do
        if not world.containerConsume(entID, {item = v , count = 1}) then
            return 
        end
    end
end

function update(dt)
    -- Are we already crafting?
    if not self.crafting then
        -- No? Check recipes.
        local hasRecipe, recipe = hasValidRecipe()
        if hasRecipe then
            self.recipe = recipe
            self.crafting = true
        end
    else
        -- Yes? Run timer.
        self.timer = self.timer + dt -- Make it work with actual SECONDS
        if self.timer >= self.recipe.time then
            generateRecipe() -- Take the recipe requirements and Generate the results
            self.crafting = false
            self.timer = 1
        end
    end
end
